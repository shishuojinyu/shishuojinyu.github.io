<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 网站标题匹配“世说金语” -->
    <title>世说金语 - 校园语录存档馆</title>
    <!-- 引用外部样式文件，保证样式统一管理 -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 外层容器实现居中 -->
    <div class="container">
        <!-- 中间白框内容区 -->
        <div class="content-box">
            <h1 class="main-title">世说金语</h1>
            <p class="sub-title">校园语录存档馆</p>
            <!-- 密码输入区域 -->
            <div class="password-form">
                <input 
                    type="password" 
                    id="password-input" 
                    placeholder="请输入访问密码" 
                    autocomplete="current-password" <!-- 允许浏览器保存密码 -->
                >
                <button id="submit-btn">确定</button>
            </div>
            <!-- 提示文本（密码错误/成功） -->
            <p class="tip-text" id="tip-text"></p>
        </div>
    </div>

    <script>
        // 核心：SHA-256哈希计算函数（适配浏览器原生API）
        async function sha256(message) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const hash = await crypto.subtle.digest('SHA-256', data);
            // 转换为十六进制字符串（与config.html中的哈希格式一致）
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // 从config.html读取密码哈希值
        async function getPasswordHash() {
            try {
                const response = await fetch('config.html');
                if (!response.ok) throw new Error('配置文件加载失败');
                const html = await response.text();
                // 正则提取config.html中的PASSWORD_HASH值
                const hashMatch = html.match(/const PASSWORD_HASH = "([a-f0-9]+)"/);
                return hashMatch ? hashMatch[1] : null;
            } catch (error) {
                console.error('获取哈希值失败：', error);
                return null;
            }
        }

        // 密码验证核心逻辑
        async function verifyPassword() {
            const passwordInput = document.getElementById('password-input');
            const tipText = document.getElementById('tip-text');
            const inputPassword = passwordInput.value.trim();

            // 空密码提示
            if (!inputPassword) {
                tipText.textContent = '请输入密码！';
                tipText.style.color = '#e74c3c';
                return;
            }

            // 获取目标哈希值
            const targetHash = await getPasswordHash();
            if (!targetHash) {
                tipText.textContent = '配置加载失败，请稍后重试！';
                tipText.style.color = '#e74c3c';
                return;
            }

            // 计算输入密码的哈希并比对
            const inputHash = await sha256(inputPassword);
            if (inputHash === targetHash) {
                // 验证成功：提示+禁用按钮+3秒跳转
                tipText.textContent = '密码正确，正在进入...';
                tipText.style.color = '#27ae60';
                passwordInput.disabled = true;
                document.getElementById('submit-btn').disabled = true;
                setTimeout(() => {
                    window.location.href = 'content.html';
                }, 3000); // 等待3秒跳转
            } else {
                // 验证失败：提示+清空输入框
                tipText.textContent = '密码错误！';
                tipText.style.color = '#e74c3c';
                passwordInput.value = '';
            }
        }

        // 绑定按钮点击事件
        document.getElementById('submit-btn').addEventListener('click', verifyPassword);
        // 绑定回车触发验证（提升体验）
        document.getElementById('password-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') verifyPassword();
        });
    </script>
</body>
</html>
