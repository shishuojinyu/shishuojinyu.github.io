<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸–è¯´é‡‘è¯­ - è¯­å½•æœç´¢</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="search-page">
    <!-- é¡¶éƒ¨æ ï¼ˆå’Œcontentä¿æŒä¸€è‡´ï¼‰ -->
    <div class="top-bar">
        <a href="content.html" class="back-btn">â† è¿”å›è¯­å½•åˆ—è¡¨</a>
    </div>

    <!-- æ ¸å¿ƒæœç´¢åŒº -->
    <div class="search-container">
        <h1 class="search-title">è¯­å½•æœç´¢</h1>
        
        <!-- æœç´¢æç¤º -->
        <div class="search-tips">
            <p>ğŸ’¡ æç¤ºï¼šæ”¯æŒå¤šä¸ªå…³é”®è¯ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼ˆå¦‚ï¼šåœŸäºº é‡‘å£°ï¼‰</p>
            <p>ğŸ” è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢ï¼Œæœç´¢èŒƒå›´å¯é€‰ã€Œå…¨éƒ¨è¯­å½•ã€æˆ–ã€ŒæŒ‡å®šè€å¸ˆã€</p>
        </div>

        <!-- æœç´¢ç­›é€‰åŒº -->
        <div class="search-filter">
            <div class="filter-item">
                <label for="search-scope">æœç´¢èŒƒå›´ï¼š</label>
                <select id="search-scope">
                    <option value="all">å…¨éƒ¨è¯­å½•</option>
                    <option value="specific">æŒ‡å®šè€å¸ˆ</option>
                </select>
            </div>
            <div class="filter-item" id="teacher-filter" style="display: none;">
                <label for="subject-select">é€‰æ‹©ç§‘ç›®ï¼š</label>
                <select id="subject-select">
                    <option value="">-- è¯·é€‰æ‹©ç§‘ç›® --</option>
                    <option value="è¯­æ–‡">è¯­æ–‡</option>
                    <option value="æ•°å­¦">æ•°å­¦</option>
                    <option value="è‹±è¯­">è‹±è¯­</option>
                    <option value="ç‰©ç†">ç‰©ç†</option>
                    <option value="åŒ–å­¦">åŒ–å­¦</option>
                    <option value="ç”Ÿç‰©">ç”Ÿç‰©</option>
                    <option value="æ”¿æ²»">æ”¿æ²»</option>
                    <option value="æ•™å®˜è¯­å½•">æ•™å®˜è¯­å½•</option>
                </select>
                <label for="teacher-select" style="margin-left: 10px;">é€‰æ‹©è€å¸ˆï¼š</label>
                <select id="teacher-select">
                    <option value="">-- å…ˆé€‰ç§‘ç›® --</option>
                </select>
            </div>
        </div>

        <!-- æœç´¢æ¡†+æŒ‰é’® -->
        <div class="search-box-wrapper">
            <input type="text" id="search-input" placeholder="è¾“å…¥å…³é”®è¯æœç´¢ï¼ˆå¦‚ï¼šåœŸäºº é‡‘å£°ï¼‰" autocomplete="off">
            <button id="search-btn" class="search-btn">ğŸ”</button>
        </div>

        <!-- æœç´¢å†å² -->
        <div class="search-history" id="search-history">
            <p class="history-title">æœç´¢å†å²ï¼š</p>
            <div class="history-list" id="history-list"></div>
            <button id="clear-history" class="clear-history-btn">æ¸…ç©ºå†å²</button>
        </div>

        <!-- æœç´¢ç»“æœåŒº -->
        <div class="search-result" id="search-result"></div>
    </div>

    <script>
        // **************************
        // ç¬¬ä¸€æ­¥ï¼šè¯­å½•æ•°æ®ï¼ˆå’Œcontentä¿æŒä¸€è‡´ï¼Œæ–°å¢è¯­å½•åªéœ€åŒæ­¥è¿™é‡Œï¼‰
        // **************************
        const quoteData = {
            // è¯­æ–‡
            "è¯­æ–‡-é™ˆç³": [
                "å¹³æ—¶ä¸æ„¿æ„åšè¿™äº›äº‹ï¼ˆæ•´æ–‡ä»¶å¤¹ï¼‰ï¼Œè¦æˆç»©æ—¶åˆé‚£ä¹ˆè¿«åˆ‡ï¼Œè®©äººåŒªå¤·æ‰€æ€ï¼ˆFeSO4ï¼‰",
                "å¦‚æœè°è®²çˆ¶ä¸ºå­çº²ï¼Œä½ è¦è·³èµ·æ¥äº†",
                "äººç”Ÿçš„ä¸€äº›é—æ†¾ï¼Œæ¯”å¦‚è€ƒä¸Šæ¸…åæ²¡ä¸ŠåŒ—å¤§"
            ],
            "è¯­æ–‡-èŒƒå¶æ–Œ": [
                "çº¢é¢œç¦æ°´",
                "å¥¹ï¼ˆå­™çŠï¼‰è¯´äº†æˆ‘å°±ä¿¡äº†",
                "å¥¹ï¼ˆå­™çŠï¼‰çš„å°è¯´æ²¡æœ‰é‚£ç§æ²¹è…»å‘³æˆ–è€…åŸå¸‚çš„å°¾æ°”å‘³å„¿"
            ],
            "è¯­æ–‡-éƒ‘å®‡ï¼ˆå°å®ï¼‰": [
                "@å…¨ä½“æˆå‘˜ èƒŒè¯µã€Šå…­å›½è®ºã€‹æ—¶ï¼ŒåŠ¡å¿…å°†è¯‘æ–‡æ”¾åœ¨è¾¹ä¸Šï¼Œä¸€è¾¹ç†é¡ºå¤§æ„ä¸€è¾¹èƒŒè¯µï¼Œä¸è¦æŠŠè¿™ä¸¤ä»¶äº‹æƒ…åˆ†å¼€å®Œæˆã€‚è¯¾ä¸‹æ³¨é‡Šä¸€å®šè¦è·Ÿè¿›è®°å¿†ã€‚ä»Šå¤©å°æµ‹ä¹Ÿæ˜¯ä¸å¤ªç†æƒ³ã€‚å¤§å®¶è¦åŠ æ²¹äº†å“ˆï¼",
                "@å…¨ä½“æˆå‘˜ å¤§å®¶è¿˜æ˜¯å°½å¯èƒ½æŠŠå…­å›½è®ºç»™å®ƒèƒŒæ‰ã€‚è¿˜æœ‰ä¸€ç¯‡ã€Šé˜¿æˆ¿å®«èµ‹ã€‹è¦èƒŒã€‚ä¸‹å‘¨ä¸€å°±è¦æœˆè€ƒäº†ã€‚è®°ä½èƒŒè¯µçš„æ—¶å€™å¤´è„‘è¦æœ‰ç”»é¢æ„Ÿï¼Œæ‘‡å¤´æ™ƒè„‘èƒŒèµ·æ¥ã€‚å‘å‡ºå£°éŸ³æ¥ã€‚èƒŒè¯µä»¥åå»æ—…æ¸¸è¿˜å¯ä»¥å…é—¨ç¥¨",
                "@å…¨ä½“æˆå‘˜ è®²è¯„è¯¾ä»¶ä¸€å®šè¦è®¤çœŸçœ‹ï¼Œä½œä¸šä¸€å®šè¦è®¤çœŸåšã€‚è¿™äº›å†…å®¹ä¸€å®šè¦ç•™åˆ°é«˜ä¸‰ã€‚"
            ],
            // æ•°å­¦
            "æ•°å­¦-é‡‘å£°": [
                "èµ–ç¥‰ç¥ºï¼Œç¡ç€äº†ï¼Œæ˜¯ä¸æ˜¯å¥½ä¹…æ²¡ä¸Šè¯¾ç¡ä¹ æƒ¯äº†",
                "ä½ ä»¬æŠŠå¶å¯è¿ç…§ç‰‡æ”¾è®²å°ä¸Šå¹²å˜›ï¼Ÿ",
                "æ˜¯ä¸æ˜¯æˆ‘èµ°åˆ°å“ªï¼Œå¤ªé˜³å…‰å°±ç…§åˆ°å“ªã€‚"
            ],
            // è‹±è¯­
            "è‹±è¯­-å†¯ç§‹äº‘ï¼ˆfqyï¼Œfrequentlyï¼‰": [
                "å‡ºå»ï¼ä¸è¦åœ¨æˆ‘çš„è¯¾ä¸Šå†™å…¶ä»–ä½œä¸šï¼",
                "ä½ ä»¬å…¨æ˜¯æƒ…æ„Ÿè’æ¼ ",
                "é˜…è¯»çš„è€å—åŠ›å¤ªå·®"
            ],
            "è‹±è¯­-èµµæ°¸æ’ï¼ˆä»“å±±ä¸€å“¥ï¼‰": [
                "æˆ‘çš„ç¬”è®°æœ¬ä¸Šæœ‰æˆ‘çš„å¤§å¤´ç…§ï¼Œä¸è¿‡å¤„ç†è¿‡äº†ï¼Œå› ä¸ºåŸåŸæœ¬æœ¬ä¼šå“åˆ°åŒå­¦",
                "æ•…æ„çš„ï¼Œä¿ç•™å®åŠ›",
                "ç­‰æˆ‘æœ‰é’±çš„æ—¶å€™ï¼Œå°±å¼€ä¸‡äººæ¼”å”±ä¼š",
                "å›½æœ‰å›½æ³•ï¼Œå®¶æœ‰å®¶è§„ï¼Œå®è·µåŸºåœ°ä¹Ÿæœ‰è‡ªå·±çš„è§„ç« åˆ¶åº¦",
                "æˆ‘ä¿¡ä»»ä½ ä»¬ï¼Œç›¸ä¿¡ä½ ä»¬å·²ç»å°†æ‰‹æœºå’Œé›¶é£Ÿä¸Šäº¤äº†",
                "ç°åœ¨å¯ä»¥ä¸¾æ‰‹äº†å§ï¼Œæˆ‘çœ‹çœ‹æœ‰å¤šå°‘äººå¸¦æ‰‹æœº"
            ],
            // ç‰©ç†
            "ç‰©ç†-é¢œæœ‰è™¹": [
                "æ”¹åˆ°ç¬¬ä¸€é—®ï¼šâ€œå—¯ï¼Ÿä¸‰è§’å‡½æ•°è¿˜ä¸é”™~â€æ”¹åˆ°ç¬¬äºŒé—®ï¼šâ€œè¿˜æ˜¯ä¸€æ ·çš„æ¸£â€",
                "å¯†å¯†éº»éº»åœ°ç»•10åœˆ",
                "æ‰€æœ‰çš„äº¤æµç”µç»Ÿç»Ÿç»™ä½ ææ­»"
            ],
            // åŒ–å­¦
            "åŒ–å­¦-ä¸¥å¿—èŠ³": [
                "Naç¦»å­ï¼ˆç¬¬ä¸€å£°ï¼‰ï¼Œä¼°è¯»ï¼ˆç¬¬ä¸‰å£°ï¼‰ï¼Œè·ç¦»ï¼ˆç¬¬ä¸‰å£°ï¼‰",
                "æ ¹éƒ½è¦çƒ‚äº†ï¼ˆè¯„ä»·æ—æ ¹ï¼‰",
                "ä¸­å¹´æ²¹è…»å¤§å”ï¼ˆè¯„ä»·é‡‘å£°ï¼‰"
            ],
            "åŒ–å­¦-ç¨‹ä¿æƒ": [
                "é‡‘åˆšçŸ³æ™¶èƒè¯·ç‰¢ç‰¢è®°ä½å®ƒæœ‰9ä¸ªC",
                "ç¢³é…¸é…¸æ€§æ€ä¹ˆä¼šæ¯”ç¡é…¸å¼ºå‘¢ï¼Ÿ",
                "1molé‡‘åˆšçŸ³å«æœ‰8molC"
            ],
            // ç”Ÿç‰©
            "ç”Ÿç‰©-é™ˆå‰ç´": [
                "å‡åŒ€åœ°æ­»å»",
                "ä¸è®²è¯„ï¼Œæˆ‘å¾…ä¼šå„¿è®²è¯„",
                "ç°åœ¨è¿™ä¹ˆä¼šè¯´ï¼Œå¾…ä¼šå„¿è¦ç»™ä½ ä¸€é“é¢˜ä½ åˆä¸ä¹æ„"
            ],
            "ç”Ÿç‰©-å¶æ°¸è": [
                "ä½ çœŸæ˜¯å“ªå£¶ä¸å¼€æå“ªå£¶ï¼Œæˆ‘å°±åœ¨è¿™é‡Œç®—ä¸ç®—äºº",
                "OKä½ ä¸ªå¤´å•Šï¼Œæˆ‘çœ‹ä½ æ˜¯è¦KOäº†",
                "è¿™ä¸ªç”·çš„æ˜¯é‡ç”Ÿå‹"
            ],
            // æ”¿æ²»
            "æ”¿æ²»-å‚…æ•": [
                "äººé«˜é©¬å¤§ï¼Œä»–è¿˜èƒ½æ¶¨ï¼Œå¤§å­¦è¿˜èƒ½é•¿",
                "é»‘çŒ«ç™½çŒ«ï¼Œèƒ½æŠ“è€é¼ çš„å°±æ˜¯å¥½è€é¼ ",
                "å•å¥•é“®è·Ÿä¸ªçŒ´ç³»å¸…å“¥ä¸€æ ·ï¼Œé™ˆæ—ä½³ä¹Ÿæ˜¯é‚»å®¶å°ä¼™"
            ],
            "æ”¿æ²»-æ—æ ¹": [
                "æ—æ°å“²å­¦æ˜¯å”¯ä¸€æ­£ç¡®çš„å“²å­¦",
                "ä¸‹é›¨è¦å¸¦ä¼ï¼ˆå’¯å±ä¹Ÿæœ‰è‡ªå·±çš„å¤©æ°”ä¹‹å­ï¼‰",
                "åªæœ‰ä¸¤æ¡è·¯ï¼šè€ƒå…¬ï¼Œè€ƒç ”"
            ],
            // æ•™å®˜è¯­å½•
            "æ•™å®˜è¯­å½•-æ˜Ÿè¾°": []
        };

        // ç§‘ç›®-è€å¸ˆæ˜ å°„ï¼ˆç”¨äºä¸‹æ‹‰ç­›é€‰ï¼‰
        const subjectTeacherMap = {
            "è¯­æ–‡": ["é™ˆç³", "èŒƒå¶æ–Œ", "éƒ‘å®‡ï¼ˆå°å®ï¼‰"],
            "æ•°å­¦": ["é‡‘å£°"],
            "è‹±è¯­": ["å†¯ç§‹äº‘ï¼ˆfqyï¼Œfrequentlyï¼‰", "èµµæ°¸æ’ï¼ˆä»“å±±ä¸€å“¥ï¼‰"],
            "ç‰©ç†": ["é¢œæœ‰è™¹"],
            "åŒ–å­¦": ["ä¸¥å¿—èŠ³", "ç¨‹ä¿æƒ"],
            "ç”Ÿç‰©": ["é™ˆå‰ç´", "å¶æ°¸è"],
            "æ”¿æ²»": ["å‚…æ•", "æ—æ ¹"],
            "æ•™å®˜è¯­å½•": ["æ˜Ÿè¾°"]
        };

        // **************************
        // ç¬¬äºŒæ­¥ï¼šæœç´¢å†å²ç›¸å…³ï¼ˆlocalStorageå­˜å‚¨ï¼‰
        // **************************
        // è·å–æœç´¢å†å²
        function getSearchHistory() {
            const history = localStorage.getItem('searchHistory');
            return history ? JSON.parse(history) : [];
        }

        // ä¿å­˜æœç´¢å†å²
        function saveSearchHistory(keyword) {
            if (!keyword.trim()) return;
            let history = getSearchHistory();
            // å»é‡+ä¿ç•™æœ€æ–°10æ¡
            history = history.filter(item => item !== keyword.trim());
            history.unshift(keyword.trim());
            if (history.length > 10) history = history.slice(0, 10);
            localStorage.setItem('searchHistory', JSON.stringify(history));
            renderSearchHistory();
        }

        // æ¸²æŸ“æœç´¢å†å²
        function renderSearchHistory() {
            const historyList = document.getElementById('history-list');
            const history = getSearchHistory();
            if (history.length === 0) {
                historyList.innerHTML = '<span class="empty-history">æš‚æ— æœç´¢å†å²</span>';
                return;
            }
            historyList.innerHTML = history.map(item => 
                `<span class="history-item" data-keyword="${item}">${item}</span>`
            ).join('');
            
            // ç‚¹å‡»å†å²é¡¹é‡æ–°æœç´¢
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.getElementById('search-input').value = item.dataset.keyword;
                    doSearch();
                });
            });
        }

        // æ¸…ç©ºæœç´¢å†å²
        function clearSearchHistory() {
            localStorage.removeItem('searchHistory');
            renderSearchHistory();
        }

        // **************************
        // ç¬¬ä¸‰æ­¥ï¼šç­›é€‰ä¸‹æ‹‰è”åŠ¨ï¼ˆç§‘ç›®â†’è€å¸ˆï¼‰
        // **************************
        function initFilter() {
            const subjectSelect = document.getElementById('subject-select');
            const teacherSelect = document.getElementById('teacher-select');
            const searchScope = document.getElementById('search-scope');

            // æœç´¢èŒƒå›´åˆ‡æ¢ï¼šæ˜¾ç¤º/éšè—è€å¸ˆç­›é€‰
            searchScope.addEventListener('change', () => {
                if (searchScope.value === 'specific') {
                    document.getElementById('teacher-filter').style.display = 'flex';
                } else {
                    document.getElementById('teacher-filter').style.display = 'none';
                }
            });

            // ç§‘ç›®é€‰æ‹©è”åŠ¨è€å¸ˆ
            subjectSelect.addEventListener('change', () => {
                const subject = subjectSelect.value;
                teacherSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©è€å¸ˆ --</option>';
                if (!subject) return;
                const teachers = subjectTeacherMap[subject];
                teachers.forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher;
                    option.textContent = teacher;
                    teacherSelect.appendChild(option);
                });
            });
        }

        // **************************
        // ç¬¬å››æ­¥ï¼šæ ¸å¿ƒæœç´¢é€»è¾‘
        // **************************
        function doSearch() {
            const searchInput = document.getElementById('search-input');
            const keyword = searchInput.value.trim();
            const searchScope = document.getElementById('search-scope').value;
            const subject = document.getElementById('subject-select').value;
            const teacher = document.getElementById('teacher-select').value;
            const resultContainer = document.getElementById('search-result');

            // æ— å…³é”®è¯æç¤º
            if (!keyword) {
                resultContainer.innerHTML = '<div class="empty-result">è¯·è¾“å…¥æœç´¢å…³é”®è¯ï½</div>';
                return;
            }

            // ä¿å­˜æœç´¢å†å²
            saveSearchHistory(keyword);

            // æ‹†åˆ†å¤šå…³é”®è¯ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
            const keywords = keyword.split(/\s+/).filter(k => k);
            let matchedQuotes = [];

            // éå†æ‰€æœ‰è¯­å½•ï¼ŒåŒ¹é…æ¡ä»¶
            for (const [key, quotes] of Object.entries(quoteData)) {
                const [subjectKey, teacherKey] = key.split('-');
                // ç­›é€‰æ¡ä»¶ï¼šæŒ‡å®šè€å¸ˆ/å…¨éƒ¨
                if (searchScope === 'specific') {
                    if (!subject || !teacher) {
                        resultContainer.innerHTML = '<div class="empty-result">æŒ‡å®šè€å¸ˆæœç´¢æ—¶ï¼Œè¯·å…ˆé€‰æ‹©ç§‘ç›®å’Œè€å¸ˆï½</div>';
                        return;
                    }
                    if (subjectKey !== subject || teacherKey !== teacher) {
                        continue;
                    }
                }

                // åŒ¹é…å…³é”®è¯ï¼ˆæ‰€æœ‰å…³é”®è¯éƒ½è¦åŒ…å«ï¼‰
                quotes.forEach((quote, index) => {
                    const matchAll = keywords.every(k => quote.toLowerCase().includes(k.toLowerCase()));
                    if (matchAll) {
                        matchedQuotes.push({
                            subject: subjectKey,
                            teacher: teacherKey,
                            quote: quote,
                            index: index + 1
                        });
                    }
                });
            }

            // æ¸²æŸ“æœç´¢ç»“æœ
            if (matchedQuotes.length === 0) {
                resultContainer.innerHTML = '<div class="empty-result">æœªæ‰¾åˆ°åŒ¹é…çš„è¯­å½•ï½</div>';
                return;
            }

            resultContainer.innerHTML = `
                <div class="result-count">æ‰¾åˆ° ${matchedQuotes.length} æ¡åŒ¹é…è¯­å½•ï¼š</div>
                <div class="result-list">
                    ${matchedQuotes.map(item => `
                        <div class="quote-card">
                            <span class="quote-number">${item.index}</span>
                            <div class="quote-meta">${item.subject} Â· ${item.teacher}è€å¸ˆ</div>
                            <p class="quote-text">${item.quote}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // **************************
        // ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–+äº‹ä»¶ç»‘å®š
        // **************************
        window.onload = function() {
            // åˆå§‹åŒ–ç­›é€‰
            initFilter();
            // æ¸²æŸ“æœç´¢å†å²
            renderSearchHistory();
            // æœç´¢æŒ‰é’®ç‚¹å‡»
            document.getElementById('search-btn').addEventListener('click', doSearch);
            // å›è½¦æœç´¢
            document.getElementById('search-input').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') doSearch();
            });
            // æ¸…ç©ºå†å²æŒ‰é’®
            document.getElementById('clear-history').addEventListener('click', clearSearchHistory);
        };
    </script>
</body>
</html>
